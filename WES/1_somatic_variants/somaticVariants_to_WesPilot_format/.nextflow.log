Dec-05 16:09:18.333 [main] DEBUG nextflow.cli.Launcher - $> nextflow run somatic_variants_format.nf --input_file /PAT-Sequenzer/WES-Pilot/WES_Pilot_final/cases/3/intermediate_3_ready.xlsx --outdir /PAT-Sequenzer/WES-Pilot/WES_Pilot_final/somatic_variants/ --reference_chain /data/reference/hg38ToHg19.over.chain --case_no 3 --segm_file /PAT-Sequenzer/WES-Pilot/WES_Pilot_input_all/CNV_all/3_segments_hg19.txt
Dec-05 16:09:18.401 [main] INFO  nextflow.cli.CmdRun - N E X T F L O W  ~  version 23.04.0
Dec-05 16:09:18.431 [main] DEBUG nextflow.plugin.PluginsFacade - Setting up plugin manager > mode=prod; embedded=false; plugins-dir=/home/pbasitta/.nextflow/plugins; core-plugins: nf-amazon@1.16.1,nf-azure@1.0.0,nf-codecommit@0.1.3,nf-console@1.0.5,nf-ga4gh@1.0.4,nf-google@1.7.2,nf-tower@1.5.11,nf-wave@0.8.1
Dec-05 16:09:18.446 [main] INFO  org.pf4j.DefaultPluginStatusProvider - Enabled plugins: []
Dec-05 16:09:18.447 [main] INFO  org.pf4j.DefaultPluginStatusProvider - Disabled plugins: []
Dec-05 16:09:18.452 [main] INFO  org.pf4j.DefaultPluginManager - PF4J version 3.4.1 in 'deployment' mode
Dec-05 16:09:18.468 [main] INFO  org.pf4j.AbstractPluginManager - No plugins
Dec-05 16:09:18.567 [main] DEBUG nextflow.cli.CmdRun - Applied DSL=2 from script declararion
Dec-05 16:09:18.590 [main] INFO  nextflow.cli.CmdRun - Launching `somatic_variants_format.nf` [festering_wiles] DSL2 - revision: 0c5652f25f
Dec-05 16:09:18.591 [main] DEBUG nextflow.plugin.PluginsFacade - Plugins default=[]
Dec-05 16:09:18.591 [main] DEBUG nextflow.plugin.PluginsFacade - Plugins resolved requirement=[]
Dec-05 16:09:18.602 [main] DEBUG nextflow.secret.LocalSecretsProvider - Secrets store: /home/pbasitta/.nextflow/secrets/store.json
Dec-05 16:09:18.611 [main] DEBUG nextflow.secret.SecretsLoader - Discovered secrets providers: [nextflow.secret.LocalSecretsProvider@56781d96] - activable => nextflow.secret.LocalSecretsProvider@56781d96
Dec-05 16:09:18.699 [main] DEBUG nextflow.Session - Session UUID: 551afe40-6566-4385-96d1-441b3957c19f
Dec-05 16:09:18.699 [main] DEBUG nextflow.Session - Run name: festering_wiles
Dec-05 16:09:18.701 [main] DEBUG nextflow.Session - Executor pool size: 12
Dec-05 16:09:18.714 [main] DEBUG nextflow.util.ThreadPoolBuilder - Creating thread pool 'FileTransfer' minSize=10; maxSize=36; workQueue=LinkedBlockingQueue[10000]; allowCoreThreadTimeout=false
Dec-05 16:09:18.745 [main] DEBUG nextflow.cli.CmdRun - 
  Version: 23.04.0 build 5857
  Created: 01-04-2023 21:09 UTC (23:09 CEST)
  System: Linux 5.14.21-150500.55.36-default
  Runtime: Groovy 3.0.16 on OpenJDK 64-Bit Server VM 17.0.8-internal+0-adhoc..src
  Encoding: UTF-8 (UTF-8)
  Process: 6067@ukb2580 [10.14.25.80]
  CPUs: 12 - Mem: 62.7 GB (420.6 MB) - Swap: 2 GB (1.9 GB)
Dec-05 16:09:18.800 [main] DEBUG nextflow.Session - Work-dir: /data/basitta/nextpipe/WES/1_somatic_variants/somaticVariants_to_WesPilot_format/work [xfs]
Dec-05 16:09:18.800 [main] DEBUG nextflow.Session - Script base path does not exist or is not a directory: /data/basitta/nextpipe/WES/1_somatic_variants/somaticVariants_to_WesPilot_format/bin
Dec-05 16:09:18.814 [main] DEBUG nextflow.executor.ExecutorFactory - Extension executors providers=[]
Dec-05 16:09:18.827 [main] DEBUG nextflow.Session - Observer factory: DefaultObserverFactory
Dec-05 16:09:18.856 [main] DEBUG nextflow.cache.CacheFactory - Using Nextflow cache factory: nextflow.cache.DefaultCacheFactory
Dec-05 16:09:18.867 [main] DEBUG nextflow.util.CustomThreadPool - Creating default thread pool > poolSize: 13; maxThreads: 1000
Dec-05 16:09:18.941 [main] DEBUG nextflow.Session - Session start
Dec-05 16:09:19.921 [main] DEBUG nextflow.script.ScriptRunner - > Launching execution
Dec-05 16:09:20.046 [main] DEBUG nextflow.executor.ExecutorFactory - << taskConfig executor: null
Dec-05 16:09:20.046 [main] DEBUG nextflow.executor.ExecutorFactory - >> processorType: 'local'
Dec-05 16:09:20.054 [main] DEBUG nextflow.executor.Executor - [warm up] executor > local
Dec-05 16:09:20.060 [main] DEBUG n.processor.LocalPollingMonitor - Creating local task monitor for executor 'local' > cpus=12; memory=62.7 GB; capacity=12; pollInterval=100ms; dumpInterval=5m
Dec-05 16:09:20.177 [main] DEBUG nextflow.executor.ExecutorFactory - << taskConfig executor: null
Dec-05 16:09:20.177 [main] DEBUG nextflow.executor.ExecutorFactory - >> processorType: 'local'
Dec-05 16:09:20.188 [main] DEBUG nextflow.executor.ExecutorFactory - << taskConfig executor: null
Dec-05 16:09:20.188 [main] DEBUG nextflow.executor.ExecutorFactory - >> processorType: 'local'
Dec-05 16:09:20.219 [main] DEBUG nextflow.Session - Workflow process names [dsl2]: WES_PILOT_FORMAT, MAKE_BED, FASTREMAP
Dec-05 16:09:20.220 [main] DEBUG nextflow.Session - Igniting dataflow network (5)
Dec-05 16:09:20.227 [main] DEBUG nextflow.processor.TaskProcessor - Starting process > MAKE_BED
Dec-05 16:09:20.228 [main] DEBUG nextflow.processor.TaskProcessor - Starting process > FASTREMAP
Dec-05 16:09:20.228 [main] DEBUG nextflow.processor.TaskProcessor - Starting process > WES_PILOT_FORMAT
Dec-05 16:09:20.228 [main] DEBUG nextflow.script.ScriptRunner - > Awaiting termination 
Dec-05 16:09:20.229 [main] DEBUG nextflow.Session - Session await
Dec-05 16:09:20.389 [Task submitter] DEBUG n.executor.local.LocalTaskHandler - Launch cmd line: /bin/bash -ue .command.run
Dec-05 16:09:20.392 [Task submitter] INFO  nextflow.Session - [90/b8baa1] Submitted process > MAKE_BED (1)
Dec-05 16:09:21.338 [Task monitor] DEBUG n.processor.TaskPollingMonitor - Task completed > TaskHandler[id: 1; name: MAKE_BED (1); status: COMPLETED; exit: 0; error: -; workDir: /data/basitta/nextpipe/WES/1_somatic_variants/somaticVariants_to_WesPilot_format/work/90/b8baa15ccec03bf8ba2ea5bffd71e5]
Dec-05 16:09:21.364 [Task submitter] DEBUG n.executor.local.LocalTaskHandler - Launch cmd line: /bin/bash -ue .command.run
Dec-05 16:09:21.365 [Task submitter] INFO  nextflow.Session - [07/e666f3] Submitted process > FASTREMAP (1)
Dec-05 16:09:21.856 [Task monitor] DEBUG n.processor.TaskPollingMonitor - Task completed > TaskHandler[id: 2; name: FASTREMAP (1); status: COMPLETED; exit: 0; error: -; workDir: /data/basitta/nextpipe/WES/1_somatic_variants/somaticVariants_to_WesPilot_format/work/07/e666f37af982708cab9b1f0a58875a]
Dec-05 16:09:21.924 [Task submitter] DEBUG n.executor.local.LocalTaskHandler - Launch cmd line: /bin/bash -ue .command.run
Dec-05 16:09:21.925 [Task submitter] INFO  nextflow.Session - [9a/cf49f0] Submitted process > WES_PILOT_FORMAT (1)
Dec-05 16:09:22.835 [Task monitor] DEBUG n.processor.TaskPollingMonitor - Task completed > TaskHandler[id: 3; name: WES_PILOT_FORMAT (1); status: COMPLETED; exit: 1; error: -; workDir: /data/basitta/nextpipe/WES/1_somatic_variants/somaticVariants_to_WesPilot_format/work/9a/cf49f0d043db067b107fff7b07464d]
Dec-05 16:09:22.841 [Task monitor] DEBUG nextflow.processor.TaskProcessor - Handling unexpected condition for
  task: name=WES_PILOT_FORMAT (1); work-dir=/data/basitta/nextpipe/WES/1_somatic_variants/somaticVariants_to_WesPilot_format/work/9a/cf49f0d043db067b107fff7b07464d
  error [nextflow.exception.ProcessFailedException]: Process `WES_PILOT_FORMAT (1)` terminated with an error exit status (1)
Dec-05 16:09:22.856 [Task monitor] ERROR nextflow.processor.TaskProcessor - Error executing process > 'WES_PILOT_FORMAT (1)'

Caused by:
  Process `WES_PILOT_FORMAT (1)` terminated with an error exit status (1)

Command executed:

  #!/usr/bin/env python
  import pandas
  
  filename = "intermediate_3_ready.xlsx"
  bed = "remapped_to_hg19.bed"
  case = "3"
  segment_file = "/PAT-Sequenzer/WES-Pilot/WES_Pilot_input_all/CNV_all/3_segments_hg19.txt"
  processed_data = pandas.read_excel(filename)
  bed_file = pandas.read_csv(bed, delimiter="	",                                header=None, names=["Chr", "Start", "End"],index_col=False)
  
  # get hg19 coordinates and assing to processed data  
  if processed_data["Chromosome"].values in bed_file["Chr"].values:
      processed_data["Chr"] = bed_file["Chr"]
      processed_data["Start"] = bed_file["Start"]
      processed_data["End"] = bed_file["End"]
  
  # get WES Pilot format
  processed_data_final = processed_data[["Chromosome", "Position", "End Position",                                      "Reference", "Allele", "GENE_SYMBOL", "HGVS_PROTEIN",                                      "TRANSCRIPT_ID",                                      "HGVS_TRANSCRIPT", "Frequency_x", "Coverage_x"]]
  
   # round AF to max 2 decimals (since AF number are str in excel, one has to set these values to int before run this script!
  processed_data_final.loc[:,"Frequency_x"]  = processed_data_final                                   ["Frequency_x"].apply(lambda x: round(x,2))
  
  # rename according to WES_Pilot_format
  processed_data_final = processed_data_final.rename(columns={"Chromosome": "Chr",                                                                 "Position": "Start",                                                                 "End Position": "End",                                                                 "Reference": "Ref",                                                                 "Allele": "Alt",                                                                 "GENE_SYMBOL": "Gen",                                                                 "HGVS_PROTEIN": "Aminosaeure",                                                                 "TRANSCRIPT_ID": "NM-Nummer",                                                                 "HGVS_TRANSCRIPT": "cDNA",                                                                 "Frequency_x": "VAF",                                                                 "Coverage_x": "Coverage"})    
  
  processed_data_final.insert(loc=0, column="Standort", value="Bonn")
  processed_data_final.insert(loc=1, column="Sample", value=case)
  processed_data_final.insert(loc=11, column="CN", value="-")
  
  # get CN number from segment_file
  segm_data = pandas.read_csv(segment_file, delimiter= "	", engine="python")
  
  # rename
  segm_data = segm_data.rename(columns={"chromosome": "Chr",                                           "start.pos": "Start",                                           "end.pos": "End"})
  
  # get chr from variants
  for i in range(len(processed_data_final)):
  
      # get corresponding chr
      segm_data_chr = segm_data[segm_data["Chr"]==str(processed_data_final["Chr"][i])]
  
      # get df with CN value
      tmp_df = processed_data_final.iloc[i,:].to_frame().T
  
      df_check_range = tmp_df.merge                        (segm_data_chr, how="cross").query                        ("(Start_x >= Start_y) & (Ende_x <= Ende_y)")
  
  
      if df_check_range.shape[0] == 1:
          cn_value = df_check_range["CNt"][df_check_range.index[0]]
          processed_data_final.loc[i,"CN"] = cn_value
  
  # write output
  processed_data_final.to_csv(case+".csv", index=False)

Command exit status:
  1

Command output:
  (empty)

Command error:
  Traceback (most recent call last):
    File ".command.sh", line 45, in <module>
      df_check_range = tmp_df.merge                        (segm_data_chr, how="cross").query                        ("(Start_x >= Start_y) & (Ende_x <= Ende_y)")
    File "/data2/basitta/miniconda3/lib/python3.9/site-packages/pandas/core/frame.py", line 4440, in query
      res = self.eval(expr, **kwargs)
    File "/data2/basitta/miniconda3/lib/python3.9/site-packages/pandas/core/frame.py", line 4566, in eval
      return _eval(expr, inplace=inplace, **kwargs)
    File "/data2/basitta/miniconda3/lib/python3.9/site-packages/pandas/core/computation/eval.py", line 336, in eval
      parsed_expr = Expr(expr, engine=engine, parser=parser, env=env)
    File "/data2/basitta/miniconda3/lib/python3.9/site-packages/pandas/core/computation/expr.py", line 809, in __init__
      self.terms = self.parse()
    File "/data2/basitta/miniconda3/lib/python3.9/site-packages/pandas/core/computation/expr.py", line 828, in parse
      return self._visitor.visit(self.expr)
    File "/data2/basitta/miniconda3/lib/python3.9/site-packages/pandas/core/computation/expr.py", line 415, in visit
      return visitor(node, **kwargs)
    File "/data2/basitta/miniconda3/lib/python3.9/site-packages/pandas/core/computation/expr.py", line 421, in visit_Module
      return self.visit(expr, **kwargs)
    File "/data2/basitta/miniconda3/lib/python3.9/site-packages/pandas/core/computation/expr.py", line 415, in visit
      return visitor(node, **kwargs)
    File "/data2/basitta/miniconda3/lib/python3.9/site-packages/pandas/core/computation/expr.py", line 424, in visit_Expr
      return self.visit(node.value, **kwargs)
    File "/data2/basitta/miniconda3/lib/python3.9/site-packages/pandas/core/computation/expr.py", line 415, in visit
      return visitor(node, **kwargs)
    File "/data2/basitta/miniconda3/lib/python3.9/site-packages/pandas/core/computation/expr.py", line 746, in visit_BoolOp
      return reduce(visitor, operands)
    File "/data2/basitta/miniconda3/lib/python3.9/site-packages/pandas/core/computation/expr.py", line 740, in visitor
      rhs = self._try_visit_binop(y)
    File "/data2/basitta/miniconda3/lib/python3.9/site-packages/pandas/core/computation/expr.py", line 735, in _try_visit_binop
      return self.visit(bop)
    File "/data2/basitta/miniconda3/lib/python3.9/site-packages/pandas/core/computation/expr.py", line 415, in visit
      return visitor(node, **kwargs)
    File "/data2/basitta/miniconda3/lib/python3.9/site-packages/pandas/core/computation/expr.py", line 719, in visit_Compare
      return self.visit(binop)
    File "/data2/basitta/miniconda3/lib/python3.9/site-packages/pandas/core/computation/expr.py", line 415, in visit
      return visitor(node, **kwargs)
    File "/data2/basitta/miniconda3/lib/python3.9/site-packages/pandas/core/computation/expr.py", line 535, in visit_BinOp
      op, op_class, left, right = self._maybe_transform_eq_ne(node)
    File "/data2/basitta/miniconda3/lib/python3.9/site-packages/pandas/core/computation/expr.py", line 455, in _maybe_transform_eq_ne
      left = self.visit(node.left, side="left")
    File "/data2/basitta/miniconda3/lib/python3.9/site-packages/pandas/core/computation/expr.py", line 415, in visit
      return visitor(node, **kwargs)
    File "/data2/basitta/miniconda3/lib/python3.9/site-packages/pandas/core/computation/expr.py", line 548, in visit_Name
      return self.term_type(node.id, self.env, **kwargs)
    File "/data2/basitta/miniconda3/lib/python3.9/site-packages/pandas/core/computation/ops.py", line 86, in __init__
      self._value = self._resolve_name()
    File "/data2/basitta/miniconda3/lib/python3.9/site-packages/pandas/core/computation/ops.py", line 110, in _resolve_name
      res = self.env.resolve(local_name, is_local=is_local)
    File "/data2/basitta/miniconda3/lib/python3.9/site-packages/pandas/core/computation/scope.py", line 246, in resolve
      raise UndefinedVariableError(key, is_local) from err
  pandas.errors.UndefinedVariableError: name 'Ende_x' is not defined

Work dir:
  /data/basitta/nextpipe/WES/1_somatic_variants/somaticVariants_to_WesPilot_format/work/9a/cf49f0d043db067b107fff7b07464d

Tip: view the complete command output by changing to the process work dir and entering the command `cat .command.out`
Dec-05 16:09:22.860 [main] DEBUG nextflow.Session - Session await > all processes finished
Dec-05 16:09:22.863 [Task monitor] DEBUG nextflow.Session - Session aborted -- Cause: Process `WES_PILOT_FORMAT (1)` terminated with an error exit status (1)
Dec-05 16:09:22.894 [main] DEBUG nextflow.Session - Session await > all barriers passed
Dec-05 16:09:22.906 [main] DEBUG nextflow.trace.WorkflowStatsObserver - Workflow completed > WorkflowStats[succeededCount=2; failedCount=1; ignoredCount=0; cachedCount=0; pendingCount=0; submittedCount=0; runningCount=0; retriesCount=0; abortedCount=0; succeedDuration=5.9s; failedDuration=879ms; cachedDuration=0ms;loadCpus=0; loadMemory=0; peakRunning=1; peakCpus=12; peakMemory=60 B; ]
Dec-05 16:09:23.093 [main] DEBUG nextflow.cache.CacheDB - Closing CacheDB done
Dec-05 16:09:23.113 [main] DEBUG nextflow.script.ScriptRunner - > Execution complete -- Goodbye
