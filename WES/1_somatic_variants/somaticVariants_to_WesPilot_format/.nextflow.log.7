Dec-05 16:16:19.098 [main] DEBUG nextflow.cli.Launcher - $> nextflow run somatic_variants_format.nf --input_file /PAT-Sequenzer/WES-Pilot/WES_Pilot_final/cases/13/intermediate_13_ready.xlsx --outdir /PAT-Sequenzer/WES-Pilot/WES_Pilot_final/somatic_variants/ --reference_chain /data/reference/hg38ToHg19.over.chain --case_no 13 --segm_file /PAT-Sequenzer/WES-Pilot/WES_Pilot_input_all/CNV_all/13_segments_hg19.txt
Dec-05 16:16:19.166 [main] INFO  nextflow.cli.CmdRun - N E X T F L O W  ~  version 23.04.0
Dec-05 16:16:19.186 [main] DEBUG nextflow.plugin.PluginsFacade - Setting up plugin manager > mode=prod; embedded=false; plugins-dir=/home/pbasitta/.nextflow/plugins; core-plugins: nf-amazon@1.16.1,nf-azure@1.0.0,nf-codecommit@0.1.3,nf-console@1.0.5,nf-ga4gh@1.0.4,nf-google@1.7.2,nf-tower@1.5.11,nf-wave@0.8.1
Dec-05 16:16:19.195 [main] INFO  org.pf4j.DefaultPluginStatusProvider - Enabled plugins: []
Dec-05 16:16:19.196 [main] INFO  org.pf4j.DefaultPluginStatusProvider - Disabled plugins: []
Dec-05 16:16:19.199 [main] INFO  org.pf4j.DefaultPluginManager - PF4J version 3.4.1 in 'deployment' mode
Dec-05 16:16:19.208 [main] INFO  org.pf4j.AbstractPluginManager - No plugins
Dec-05 16:16:19.288 [main] DEBUG nextflow.cli.CmdRun - Applied DSL=2 from script declararion
Dec-05 16:16:19.308 [main] INFO  nextflow.cli.CmdRun - Launching `somatic_variants_format.nf` [stoic_woese] DSL2 - revision: 94eb79da3f
Dec-05 16:16:19.309 [main] DEBUG nextflow.plugin.PluginsFacade - Plugins default=[]
Dec-05 16:16:19.310 [main] DEBUG nextflow.plugin.PluginsFacade - Plugins resolved requirement=[]
Dec-05 16:16:19.323 [main] DEBUG nextflow.secret.LocalSecretsProvider - Secrets store: /home/pbasitta/.nextflow/secrets/store.json
Dec-05 16:16:19.334 [main] DEBUG nextflow.secret.SecretsLoader - Discovered secrets providers: [nextflow.secret.LocalSecretsProvider@4565a70a] - activable => nextflow.secret.LocalSecretsProvider@4565a70a
Dec-05 16:16:19.419 [main] DEBUG nextflow.Session - Session UUID: 6924742a-a694-4971-8c5c-092fc21dfeb4
Dec-05 16:16:19.419 [main] DEBUG nextflow.Session - Run name: stoic_woese
Dec-05 16:16:19.421 [main] DEBUG nextflow.Session - Executor pool size: 12
Dec-05 16:16:19.433 [main] DEBUG nextflow.util.ThreadPoolBuilder - Creating thread pool 'FileTransfer' minSize=10; maxSize=36; workQueue=LinkedBlockingQueue[10000]; allowCoreThreadTimeout=false
Dec-05 16:16:19.458 [main] DEBUG nextflow.cli.CmdRun - 
  Version: 23.04.0 build 5857
  Created: 01-04-2023 21:09 UTC (23:09 CEST)
  System: Linux 5.14.21-150500.55.36-default
  Runtime: Groovy 3.0.16 on OpenJDK 64-Bit Server VM 17.0.8-internal+0-adhoc..src
  Encoding: UTF-8 (UTF-8)
  Process: 20281@ukb2580 [10.14.25.80]
  CPUs: 12 - Mem: 62.7 GB (423.4 MB) - Swap: 2 GB (1.9 GB)
Dec-05 16:16:19.488 [main] DEBUG nextflow.Session - Work-dir: /data/basitta/nextpipe/WES/1_somatic_variants/somaticVariants_to_WesPilot_format/work [xfs]
Dec-05 16:16:19.488 [main] DEBUG nextflow.Session - Script base path does not exist or is not a directory: /data/basitta/nextpipe/WES/1_somatic_variants/somaticVariants_to_WesPilot_format/bin
Dec-05 16:16:19.499 [main] DEBUG nextflow.executor.ExecutorFactory - Extension executors providers=[]
Dec-05 16:16:19.510 [main] DEBUG nextflow.Session - Observer factory: DefaultObserverFactory
Dec-05 16:16:19.536 [main] DEBUG nextflow.cache.CacheFactory - Using Nextflow cache factory: nextflow.cache.DefaultCacheFactory
Dec-05 16:16:19.546 [main] DEBUG nextflow.util.CustomThreadPool - Creating default thread pool > poolSize: 13; maxThreads: 1000
Dec-05 16:16:19.612 [main] DEBUG nextflow.Session - Session start
Dec-05 16:16:20.494 [main] DEBUG nextflow.script.ScriptRunner - > Launching execution
Dec-05 16:16:20.612 [main] DEBUG nextflow.executor.ExecutorFactory - << taskConfig executor: null
Dec-05 16:16:20.612 [main] DEBUG nextflow.executor.ExecutorFactory - >> processorType: 'local'
Dec-05 16:16:20.618 [main] DEBUG nextflow.executor.Executor - [warm up] executor > local
Dec-05 16:16:20.623 [main] DEBUG n.processor.LocalPollingMonitor - Creating local task monitor for executor 'local' > cpus=12; memory=62.7 GB; capacity=12; pollInterval=100ms; dumpInterval=5m
Dec-05 16:16:20.725 [main] DEBUG nextflow.executor.ExecutorFactory - << taskConfig executor: null
Dec-05 16:16:20.725 [main] DEBUG nextflow.executor.ExecutorFactory - >> processorType: 'local'
Dec-05 16:16:20.734 [main] DEBUG nextflow.executor.ExecutorFactory - << taskConfig executor: null
Dec-05 16:16:20.734 [main] DEBUG nextflow.executor.ExecutorFactory - >> processorType: 'local'
Dec-05 16:16:20.759 [main] DEBUG nextflow.Session - Workflow process names [dsl2]: WES_PILOT_FORMAT, MAKE_BED, FASTREMAP
Dec-05 16:16:20.759 [main] DEBUG nextflow.Session - Igniting dataflow network (5)
Dec-05 16:16:20.766 [main] DEBUG nextflow.processor.TaskProcessor - Starting process > MAKE_BED
Dec-05 16:16:20.768 [main] DEBUG nextflow.processor.TaskProcessor - Starting process > FASTREMAP
Dec-05 16:16:20.769 [main] DEBUG nextflow.processor.TaskProcessor - Starting process > WES_PILOT_FORMAT
Dec-05 16:16:20.769 [main] DEBUG nextflow.script.ScriptRunner - > Awaiting termination 
Dec-05 16:16:20.769 [main] DEBUG nextflow.Session - Session await
Dec-05 16:16:20.964 [Task submitter] DEBUG n.executor.local.LocalTaskHandler - Launch cmd line: /bin/bash -ue .command.run
Dec-05 16:16:20.970 [Task submitter] INFO  nextflow.Session - [58/3f03b9] Submitted process > MAKE_BED (1)
Dec-05 16:16:21.986 [Task monitor] DEBUG n.processor.TaskPollingMonitor - Task completed > TaskHandler[id: 1; name: MAKE_BED (1); status: COMPLETED; exit: 0; error: -; workDir: /data/basitta/nextpipe/WES/1_somatic_variants/somaticVariants_to_WesPilot_format/work/58/3f03b9ca0a57a45fcdd5603e38f5ae]
Dec-05 16:16:22.022 [Task submitter] DEBUG n.executor.local.LocalTaskHandler - Launch cmd line: /bin/bash -ue .command.run
Dec-05 16:16:22.023 [Task submitter] INFO  nextflow.Session - [d4/2ef361] Submitted process > FASTREMAP (1)
Dec-05 16:16:22.567 [Task monitor] DEBUG n.processor.TaskPollingMonitor - Task completed > TaskHandler[id: 2; name: FASTREMAP (1); status: COMPLETED; exit: 0; error: -; workDir: /data/basitta/nextpipe/WES/1_somatic_variants/somaticVariants_to_WesPilot_format/work/d4/2ef361b5ad05350295c84aa5b8d0e0]
Dec-05 16:16:22.634 [Task submitter] DEBUG n.executor.local.LocalTaskHandler - Launch cmd line: /bin/bash -ue .command.run
Dec-05 16:16:22.635 [Task submitter] INFO  nextflow.Session - [6f/d7f056] Submitted process > WES_PILOT_FORMAT (1)
Dec-05 16:16:23.445 [Task monitor] DEBUG n.processor.TaskPollingMonitor - Task completed > TaskHandler[id: 3; name: WES_PILOT_FORMAT (1); status: COMPLETED; exit: 1; error: -; workDir: /data/basitta/nextpipe/WES/1_somatic_variants/somaticVariants_to_WesPilot_format/work/6f/d7f0562281666ed0387099e7282788]
Dec-05 16:16:23.449 [Task monitor] DEBUG nextflow.processor.TaskProcessor - Handling unexpected condition for
  task: name=WES_PILOT_FORMAT (1); work-dir=/data/basitta/nextpipe/WES/1_somatic_variants/somaticVariants_to_WesPilot_format/work/6f/d7f0562281666ed0387099e7282788
  error [nextflow.exception.ProcessFailedException]: Process `WES_PILOT_FORMAT (1)` terminated with an error exit status (1)
Dec-05 16:16:23.460 [Task monitor] ERROR nextflow.processor.TaskProcessor - Error executing process > 'WES_PILOT_FORMAT (1)'

Caused by:
  Process `WES_PILOT_FORMAT (1)` terminated with an error exit status (1)

Command executed:

  #!/usr/bin/env python
  import pandas
  
  filename = "intermediate_13_ready.xlsx"
  bed = "remapped_to_hg19.bed"
  case = "13"
  segment_file = "/PAT-Sequenzer/WES-Pilot/WES_Pilot_input_all/CNV_all/13_segments_hg19.txt"
  processed_data = pandas.read_excel(filename)
  bed_file = pandas.read_csv(bed, delimiter="	",                                header=None, names=["Chr", "Start", "End"],index_col=False)
  
  # get hg19 coordinates and assing to processed data  
  if processed_data["Chromosome"].values in bed_file["Chr"].values:
      processed_data["Chr"] = bed_file["Chr"]
      processed_data["Start"] = bed_file["Start"]
      processed_data["End"] = bed_file["End"]
  
  # get WES Pilot format
  processed_data_final = processed_data[["Chromosome", "Position", "End Position",                                      "Reference", "Allele", "GENE_SYMBOL", "HGVS_PROTEIN",                                      "TRANSCRIPT_ID",                                      "HGVS_TRANSCRIPT", "Frequency_x", "Coverage_x"]]
  
   # round AF to max 2 decimals (since AF number are str in excel, one has to set these values to int before run this script!
  processed_data_final.loc[:,"Frequency_x"]  = processed_data_final                                   ["Frequency_x"].apply(lambda x: round(x,2))
  
  # rename according to WES_Pilot_format
  processed_data_final = processed_data_final.rename(columns={"Chromosome": "Chr",                                                                 "Position": "Start",                                                                 "End Position": "End",                                                                 "Reference": "Ref",                                                                 "Allele": "Alt",                                                                 "GENE_SYMBOL": "Gen",                                                                 "HGVS_PROTEIN": "Aminosaeure",                                                                 "TRANSCRIPT_ID": "NM-Nummer",                                                                 "HGVS_TRANSCRIPT": "cDNA",                                                                 "Frequency_x": "VAF",                                                                 "Coverage_x": "Coverage"})    
  
  processed_data_final.insert(loc=0, column="Standort", value="Bonn")
  processed_data_final.insert(loc=1, column="Sample", value=case)
  processed_data_final.insert(loc=11, column="CN", value="-")
  
  # get CN number from segment_file
  segm_data = pandas.read_csv(segment_file, delimiter= "	", engine="python")
  
  # rename
  segm_data = segm_data.rename(columns={"chromosome": "Chr",                                           "start.pos": "Start",                                           "end.pos": "End"})
  
  # get chr from variants
  for i in range(len(processed_data_final)):
  
      # get corresponding chr
      segm_data_chr = segm_data[segm_data["Chr"]==str(processed_data_final["Chr"][i])]
  
      # get df with CN value
      tmp_df = processed_data_final.iloc[i,:].to_frame().T
  
      df_check_range = tmp_df.merge                        (segm_data_chr, how="cross").query                        ("(Start_x >= Start_y) & (End_x <= End_y)")
  
  
      if df_check_range.shape[0] == 1:
          cn_value = df_check_range["CNt"][df_check_range.index[0]]
          processed_data_final.loc[i,"CN"] = cn_value
  
  # write output
  processed_data_final.to_csv(case+".csv", index=False)

Command exit status:
  1

Command output:
  (empty)

Command error:
  Traceback (most recent call last):
    File ".command.sh", line 21, in <module>
      processed_data_final.loc[:,"Frequency_x"]  = processed_data_final                                   ["Frequency_x"].apply(lambda x: round(x,2))
    File "/data2/basitta/miniconda3/lib/python3.9/site-packages/pandas/core/series.py", line 4630, in apply
      return SeriesApply(self, func, convert_dtype, args, kwargs).apply()
    File "/data2/basitta/miniconda3/lib/python3.9/site-packages/pandas/core/apply.py", line 1025, in apply
      return self.apply_standard()
    File "/data2/basitta/miniconda3/lib/python3.9/site-packages/pandas/core/apply.py", line 1076, in apply_standard
      mapped = lib.map_infer(
    File "pandas/_libs/lib.pyx", line 2834, in pandas._libs.lib.map_infer
    File ".command.sh", line 21, in <lambda>
      processed_data_final.loc[:,"Frequency_x"]  = processed_data_final                                   ["Frequency_x"].apply(lambda x: round(x,2))
  TypeError: type str doesn't define __round__ method

Work dir:
  /data/basitta/nextpipe/WES/1_somatic_variants/somaticVariants_to_WesPilot_format/work/6f/d7f0562281666ed0387099e7282788

Tip: you can replicate the issue by changing to the process work dir and entering the command `bash .command.run`
Dec-05 16:16:23.464 [main] DEBUG nextflow.Session - Session await > all processes finished
Dec-05 16:16:23.465 [Task monitor] DEBUG nextflow.Session - Session aborted -- Cause: Process `WES_PILOT_FORMAT (1)` terminated with an error exit status (1)
Dec-05 16:16:23.479 [main] DEBUG nextflow.Session - Session await > all barriers passed
Dec-05 16:16:23.486 [main] DEBUG nextflow.trace.WorkflowStatsObserver - Workflow completed > WorkflowStats[succeededCount=2; failedCount=1; ignoredCount=0; cachedCount=0; pendingCount=0; submittedCount=0; runningCount=0; retriesCount=0; abortedCount=0; succeedDuration=6.8s; failedDuration=778ms; cachedDuration=0ms;loadCpus=0; loadMemory=0; peakRunning=1; peakCpus=12; peakMemory=60 B; ]
Dec-05 16:16:23.685 [main] DEBUG nextflow.cache.CacheDB - Closing CacheDB done
Dec-05 16:16:23.698 [main] DEBUG nextflow.script.ScriptRunner - > Execution complete -- Goodbye
